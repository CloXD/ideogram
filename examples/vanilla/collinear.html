<!DOCTYPE html>
<html>
<head>
  <title>Collinear | Ideogram</title>
  <style>body {font: 12px Arial; line-height: 19.6px;}</style>
  <script type="text/javascript" src="../../dist/js/ideogram.min.js"></script>
        <style>
          html, body {
            height: 100%;
            font: 12px Arial;
            line-height: 19.6px;
          }

        </style>
</head>
<body>
  <h1>Collinear | Ideogram</h1>
  <a href="../">Back to overview</a> |
  <a href="multiple-primates">Previous</a> |
  <a href="mouse">Next</a>
  <p>
    A human genome is depicted below.  Unlike the common
    <a href="human.html">parallel arrangement</a>, this ideogram is collinear.
  </p>
  <script type="text/javascript">

    d3 = Ideogram.d3;

    function collinearizeGenome() {
      chrSets = document.querySelectorAll('.chromosome-set-container');
      firstChrSetY = chrSets[0].transform.baseVal[0].matrix.f;

      widthOffset = 0;

      // Get pixel coordinates to use for rearrangement
      var translations = [];
      for (i = 0; i < chrSets.length; i++) {
        chrSet = chrSets[i];
        index = (i === 0) ? i : i - 1;
        prevChrSet = chrSets[index];
        prevChrSetRect = prevChrSet.getBoundingClientRect();
        prevChrSetMatrix = prevChrSet.transform.baseVal[0].matrix;
        prevChrSetTransform = {x: prevChrSetMatrix.e, y: prevChrSetMatrix.f};
        if (i === 0) {
          x = 20;
        } else {
          prevWidth = prevChrSetRect.width;
          prevX = translations[index][0];
          widthOffset += prevWidth;
          x = Math.round(prevX + prevWidth) + 2;
        }
        y = firstChrSetY;
        translations.push([x, y]);
      }

      // Rearrange chromosomes from horizontal to collinear
      for (i = 0; i < chrSets.length; i++) {
        chrSet = chrSets[i];
        x = translations[i][0];
        y = translations[i][1];
        if (ideogram.config.showChromosomeLabels) {
          // Will need special handling for chromosome labels
          chrSet.querySelector('.chrLabel').setAttribute('y', '5')
          chrSet.querySelector('.chrLabel').setAttribute('text-anchor', 'middle')
        }
        chrSet.setAttribute('transform', 'translate(' + x + ',' + y + ')');
        chrSet.querySelector('.chromosome').setAttribute('transform', 'translate(-13, 10)');
      }

      document.querySelector('#_ideogram').setAttribute('width', widthOffset + 120);
    }

    ideogram = new Ideogram({
      organism: 'human',
      orientation: 'horizontal',
      showFullyBanded: false,
      showChromosomeLabels: false,
      chrHeight: 70,
      onLoad: collinearizeGenome
    });
  </script>
</body>
</html>
